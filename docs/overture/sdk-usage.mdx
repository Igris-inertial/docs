# SDK Usage

Igris Inertial provides official SDKs for Go, Python, TypeScript/JavaScript, and Rust, plus community SDKs for Ruby, Java, and C#. All SDKs target the Overture API. When Overture is backed by a Runtime instance, responses include a signed `execution_receipt` with resource-accounting data.

---

## Go SDK

### Installation

```bash
go get github.com/igris-inertial/go-sdk
```

### Quick Start

```go
package main

import (
    "context"
    "fmt"
    "log"

    igris "github.com/igris-inertial/go-sdk"
)

func main() {
    client := igris.NewClient(
        "https://api.igris-inertial.com",
        "your-api-key",
    )

    resp, err := client.Infer(context.Background(), &igris.InferRequest{
        Model: "gpt-4",
        Messages: []igris.Message{
            {Role: "user", Content: "Hello!"},
        },
    })
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(resp.Choices[0].Message.Content)
}
```

### API Methods

```go
client := igris.NewClient(baseURL, apiKey, igris.WithTenantID("t1"))

// Inference
client.Infer(ctx, &igris.InferRequest{...})
client.ChatCompletion(ctx, &igris.InferRequest{...})
client.ListModels(ctx)
client.Health(ctx)

// Providers
client.Providers.Register(ctx, &igris.ProviderConfig{...})
client.Providers.List(ctx)
client.Providers.Test(ctx, &igris.ProviderConfig{...})
client.Providers.Update(ctx, id, config)
client.Providers.Delete(ctx, id)
client.Providers.Health(ctx, id)

// Vault
client.Vault.Store(ctx, &igris.VaultStoreRequest{...})
client.Vault.List(ctx)
client.Vault.Rotate(ctx, "openai")
client.Vault.Delete(ctx, "openai")

// Fleet
client.Fleet.Register(ctx, config)
client.Fleet.Agents(ctx)
client.Fleet.Health(ctx)
client.Fleet.Telemetry(ctx, fleetID, data)

// Usage & Audit
client.Usage.Current(ctx)
client.Usage.History(ctx, params)
client.Audit.List(ctx, params)
```

### Execution Receipt Verification (v2.2.0+)

```go
import (
    "crypto/ed25519"
    "encoding/hex"

    igris "github.com/igris-inertial/go-sdk"
)

if resp.ExecutionReceipt != nil {
    pubKeyBytes, _ := hex.DecodeString("...") // IGRIS_RUNTIME_PUBLIC_KEY
    pub := ed25519.PublicKey(pubKeyBytes)

    if err := igris.VerifyReceipt(resp.ExecutionReceipt, pub); err != nil {
        log.Printf("receipt verification failed: %v", err)
    }

    fmt.Printf("cpu=%dms wall=%dms violation=%v\n",
        resp.ExecutionReceipt.CpuTimeMs,
        resp.ExecutionReceipt.WallTimeMs,
        resp.ExecutionReceipt.ViolationOccurred,
    )
}
```

`VerifyReceipt` is never called automatically. Uses only the Go standard library. Responses from servers that do not emit receipts decode normally — `ExecutionReceipt` will be `nil`.

---

## Python SDK

### Installation

```bash
pip install igris-inertial

# For receipt verification (requires PyNaCl):
pip install igris-inertial[verification]
```

### Quick Start

```python
from igris import IgrisClient, InferRequest, Message

client = IgrisClient(
    base_url="https://api.igris-inertial.com",
    api_key="your-api-key",
)

response = client.infer(InferRequest(
    model="gpt-4",
    messages=[Message(role="user", content="Hello!")],
))

print(response.choices[0].message.content)
```

### API Methods

```python
# Inference
client.infer(InferRequest(...))
client.list_models()
client.health()

# Providers
client.providers.register({"name": "OpenAI", "type": "openai", "api_key": "sk-..."})
client.providers.list()
client.providers.test({"name": "OpenAI", "type": "openai"})
client.providers.health("provider-id")
client.providers.delete("provider-id")

# Vault
client.vault.store("openai", "sk-your-key")
client.vault.list()
client.vault.rotate("openai")
client.vault.delete("openai")

# Fleet
client.fleet.register({"name": "agent-1", "capabilities": ["gpt-4"]})
client.fleet.agents()
client.fleet.health()
client.fleet.telemetry("fleet-id", {"cpu": 0.5, "memory": 0.8})

# Usage & Audit
client.usage.current()
client.usage.history({"period": "7d"})
client.audit.list({"limit": 50})
```

### Execution Receipt Verification (v2.2.0+)

```python
from igris.receipt import verify_receipt
import binascii

if resp.execution_receipt:
    pub_key = binascii.unhexlify("...")  # IGRIS_RUNTIME_PUBLIC_KEY
    ok = verify_receipt(resp.execution_receipt, pub_key)
    print(f"valid={ok}  cpu={resp.execution_receipt.cpu_time_ms}ms  "
          f"violation={resp.execution_receipt.violation_occurred}")
```

`verify_receipt` accepts both the `ExecutionReceipt` Pydantic model and a plain dict. It is never called automatically. Requires `PyNaCl` (install with the `[verification]` extra).

---

## TypeScript / JavaScript SDK

### Installation

```bash
npm install @igris-inertial/sdk
```

### Quick Start

```typescript
import { IgrisClient } from '@igris-inertial/sdk';

const client = new IgrisClient({
  baseUrl: 'https://api.igris-inertial.com',
  apiKey: 'your-api-key',
});

const response = await client.infer({
  model: 'gpt-4',
  messages: [{ role: 'user', content: 'Hello!' }],
});

console.log(response.choices[0].message.content);
```

### API Methods

```typescript
// Inference
await client.infer(request);
await client.chatCompletion(request);
await client.listModels();
await client.health();

// Providers
await client.providers.register(config);
await client.providers.list();
await client.providers.test(config);
await client.providers.update(id, config);
await client.providers.delete(id);
await client.providers.health(id);

// Vault
await client.vault.store('openai', 'sk-key');
await client.vault.list();
await client.vault.rotate('openai');
await client.vault.delete('openai');

// Fleet
await client.fleet.register(config);
await client.fleet.agents();
await client.fleet.health();
await client.fleet.telemetry(fleetId, data);

// Usage & Audit
await client.usage.current();
await client.usage.history({ period: '7d' });
await client.audit.list({ limit: '50' });
```

### Execution Receipt Verification (v2.2.0+)

```typescript
import { verifyReceipt } from '@igris-inertial/sdk';

if (resp.execution_receipt) {
  const pubKeyHex = '...'; // IGRIS_RUNTIME_PUBLIC_KEY
  const pubKeyBytes = Uint8Array.from(Buffer.from(pubKeyHex, 'hex'));

  const ok = await verifyReceipt(resp.execution_receipt, pubKeyBytes);
  console.log(`valid=${ok} cpu=${resp.execution_receipt.cpu_time_ms}ms `
    + `violation=${resp.execution_receipt.violation_occurred}`);
}
```

`verifyReceipt` is async (Web Crypto SHA-256 + tweetnacl). ESM and CJS dual module output, native fetch (Node 18+, no external HTTP dependency). `execution_receipt` is `undefined` when the server does not emit receipts.

---

## Rust SDK

### Installation

Add to `Cargo.toml`:

```toml
[dependencies]
igris-inertial = "2.2"
tokio = { version = "1", features = ["full"] }
```

### Quick Start

```rust
use igris_inertial::{IgrisClient, InferRequest, Message};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let client = IgrisClient::builder("https://api.igris-inertial.com")
        .api_key("your-api-key")
        .build()?;

    let response = client.infer(&InferRequest {
        model: "gpt-4".to_string(),
        messages: vec![Message {
            role: "user".to_string(),
            content: "Hello!".to_string(),
            content_parts: None,
        }],
        ..Default::default()
    }).await?;

    println!("{}", response.choices[0].message.content);
    Ok(())
}
```

### API Methods

```rust
// Inference
client.infer(&request).await?;
client.chat_completion(&request).await?;
client.list_models().await?;
client.health().await?;

// Providers
client.providers().register(&config).await?;
client.providers().list().await?;
client.providers().test(&config).await?;
client.providers().health("id").await?;
client.providers().delete("id").await?;

// Vault
client.vault().store(&request).await?;
client.vault().list().await?;
client.vault().rotate("openai").await?;
client.vault().delete("openai").await?;

// Fleet
client.fleet().register(&config).await?;
client.fleet().agents().await?;
client.fleet().health().await?;

// Usage & Audit
client.usage().current().await?;
client.usage().history().await?;
client.audit().list().await?;
```

### Execution Receipt Verification (v2.2.0+)

```rust
use igris_inertial::{verify_receipt, IgrisClient};
use ed25519_dalek::VerifyingKey;

if let Some(receipt) = &resp.execution_receipt {
    let pub_key_bytes: [u8; 32] = hex::decode("...") // IGRIS_RUNTIME_PUBLIC_KEY
        .unwrap().try_into().unwrap();
    let vk = VerifyingKey::from_bytes(&pub_key_bytes)?;

    verify_receipt(receipt, &vk)?;
    println!("cpu={}ms violation={}", receipt.cpu_time_ms, receipt.violation_occurred);
}
```

`verify_receipt` is never called automatically. Uses `ed25519-dalek` v2 + `sha2` + `base64`. `execution_receipt` is `None` when the server does not emit receipts.

---

## OpenAI-Compatible API

Overture exposes an OpenAI-compatible endpoint. Point any OpenAI SDK to the Igris base URL:

```python
from openai import OpenAI

client = OpenAI(
    base_url="https://api.igris-inertial.com/v1",
    api_key="your-api-key"
)

response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello"}]
)
```

OpenAI-compatible responses do not include `execution_receipt`. Use the native Igris SDKs to access execution receipts and verify signatures.

---

## Other SDKs

Community-maintained SDKs are available for:

| Language | Package |
|---|---|
| Ruby | `gem install igris-inertial` |
| Java | `com.igris-inertial:igris-java-sdk:2.2.0` (Maven Central) |
| C# | `dotnet add package Igris.Inertial` (NuGet) |

---

## Response Format

All native SDKs return typed responses. The `execution_receipt` field is present only when the server is backed by a Runtime instance:

```json
{
  "id": "chatcmpl-abc123",
  "object": "chat.completion",
  "created": 1677652288,
  "model": "gpt-4",
  "choices": [
    {
      "index": 0,
      "message": { "role": "assistant", "content": "..." },
      "finish_reason": "stop"
    }
  ],
  "usage": { "prompt_tokens": 15, "completion_tokens": 42, "total_tokens": 57 },
  "metadata": {
    "provider": "openai",
    "latency_ms": 234,
    "cost_usd": 0.00171
  },
  "execution_receipt": {
    "execution_id": "0194f3b2-...",
    "transaction_id": "0194f3b2-...",
    "transaction_hash": "sha256:...",
    "cpu_time_ms": 142,
    "wall_time_ms": 380,
    "memory_peak_mb": 48,
    "fs_bytes_written": 0,
    "tool_calls": 3,
    "violation_occurred": false,
    "timestamp_utc": "2026-02-21T10:00:00.123Z",
    "hash": "sha256:...",
    "signature": "base64:..."
  }
}
```

`execution_receipt` is `null`/`nil`/`None`/`undefined` when the server is not backed by a Runtime instance. All SDK types are backward-compatible with v1.x responses.

---

## SDK Versions

| SDK | Package | Version |
|---|---|---|
| Go | `github.com/igris-inertial/go-sdk` | v2.2.0 |
| Python | `igris-inertial` (PyPI) | 2.2.0 |
| TypeScript | `@igris-inertial/sdk` (npm) | 2.2.0 |
| Rust | `igris-inertial` (crates.io) | 2.2.0 |

---

## Next Steps

- [API Reference](/docs/api-reference) — Complete endpoint documentation
- [Execution Verification](/docs/governance/execution-verification) — Receipt signing and Overture verification
- [Architecture](/docs/architecture) — System design and components
- [Observability](/docs/observability) — Monitoring and tracing
