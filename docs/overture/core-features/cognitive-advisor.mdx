# Cognitive Advisor

**Your AI routing gets smarter every day — automatically.**

Igris Overture analyzes provider performance and suggests optimizations. Every recommendation includes clear reasoning, projected impact, and risk scoring. Choose human-in-the-loop approval or enable auto-apply with automatic rollback protection.

---

## Quick Example

```bash
# Get AI-generated recommendations
curl https://api.igrisinertial.com/v1/cognitive/proposals?status=pending
```

**Response:**
```json
{
  "proposals": [
    {
      "proposal_id": "prop_abc123",
      "confidence": 0.92,
      "rationale": "Provider 'openai/gpt-4' showing degradation: 5.2% error rate. Anthropic has 99.1% success rate.",
      "projected_impact": {
        "latency_reduction": "35.6%",
        "cost_savings": "$124/month",
        "error_rate_improvement": "4.1%"
      },
      "proposed_action": "Shift traffic from OpenAI to Anthropic",
      "status": "pending_your_review"
    }
  ]
}
```

---

## What You Get

### AI-Powered Recommendations

The system continuously analyzes:
- **Provider Performance**: Error rates, latency, success rates
- **Cost Efficiency**: Which providers give best value
- **Traffic Patterns**: Historical trends and anomalies
- **Routing Decisions**: Thompson Sampling effectiveness

### Two Approval Modes

Choose the approval mode that fits your workflow:

**Human-in-the-Loop (Default):**
- **Manual Review**: Proposals require explicit approval
- **Clear Reasoning**: Understand why changes are suggested
- **Risk Assessment**: See confidence and risk scores
- **One-Click Apply**: Approve recommendations you trust

**Auto-Apply with Rollback Protection (Opt-in):**
- **Automatic Execution**: High-confidence, low-risk proposals apply automatically
- **Configurable Thresholds**: Set minimum confidence (default: 0.90) and max risk (default: 0.30)
- **Automatic Rollback**: Reverts changes if performance degrades >10%
- **1-Hour Monitoring Window**: Changes monitored for degradation before becoming permanent

### Confidence & Risk Scoring

Every proposal includes quantified confidence and risk:

```json
{
  "proposal_id": "prop_abc123",
  "confidence": 0.92,
  "risk_score": 0.15,
  "projected_impact": {
    "latency_p95_reduction_pct": 35.6,
    "cost_saving_usd_monthly": 124.50,
    "expected_error_rate_improvement": 4.1
  }
}
```

**Confidence Score (0.0 - 1.0):** Statistical certainty in the recommendation based on sample size and variance.

**Risk Score (0.0 - 1.0):** Potential for negative impact, calculated from weight change magnitude and historical variance.

| Confidence | Risk | Recommendation |
|------------|------|----------------|
| &gt;0.90 | &lt;0.20 | Safe for auto-apply |
| &gt;0.85 | &lt;0.30 | Recommended for approval |
| &gt;0.75 | &lt;0.50 | Review carefully |
| &lt;0.75 | &gt;0.50 | Extra scrutiny needed |

---

## How It Works

<details>
<summary><strong>1. Continuous Analysis (Every 15 Minutes)</strong></summary>

The Cognitive Advisor monitors all providers:
- Error rates and success rates
- Latency percentiles (p50, p95, p99)
- Cost per request
- Thompson Sampling parameters
- Traffic distribution

</details>

<details>
<summary><strong>2. Recommendation Generation</strong></summary>

When performance issues are detected:

1. **Identifies Problem**: "OpenAI error rate increased 3x in past hour"
2. **Finds Solution**: "Anthropic maintaining 99% success rate"
3. **Calculates Impact**: "Shifting 50% traffic reduces errors by 4%"
4. **Generates Proposal**: Human-readable recommendation with evidence

</details>

<details>
<summary><strong>3. Safety Checks</strong></summary>

Before generating a proposal:
- **Confidence Gate**: Must be >75% confident in recommendation
- **Risk Assessment**: Quantifies rollback risk
- **Drift Detection**: Prevents excessive changes
- **Minimum Data**: Requires statistical significance (100+ requests)

Proposals below 85% confidence are flagged for extra review.

</details>

<details>
<summary><strong>4. Human Review & Approval</strong></summary>

You decide what gets applied:

```bash
# Review proposal
GET /v1/cognitive/proposals/prop_abc123

# Approve it
POST /v1/cognitive/proposals/prop_abc123/approve
{
  "approved_by": "admin@example.com",
  "notes": "Looks good, applying"
}
```

</details>

---

## Recommendation Types

### 1. Traffic Shifting

When a provider underperforms:

```json
{
  "type": "traffic_shift",
  "from_provider": "openai/gpt-4",
  "to_provider": "anthropic/claude-3-sonnet",
  "rationale": "OpenAI: 5.2% errors. Anthropic: 0.9% errors",
  "projected_improvement": "4.3% error reduction"
}
```

### 2. Thompson Sampling Optimization

Adjusting routing parameters:

```json
{
  "type": "thompson_tuning",
  "provider": "openai/gpt-4",
  "action": "reduce_selection_probability",
  "rationale": "Elevated error rate warrants lower priority",
  "confidence": 0.89
}
```

### 3. Cost Optimization

Finding cheaper alternatives:

```json
{
  "type": "cost_optimization",
  "current_provider": "gpt-4",
  "suggested_provider": "gpt-3.5-turbo",
  "task_type": "simple_queries",
  "cost_savings": "$450/month",
  "quality_impact": "minimal (<2% difference)"
}
```

### 4. Semantic Routing Adjustments

Optimizing task-to-provider mapping:

```json
{
  "type": "intent_optimization",
  "intent": "code_generation",
  "current_preference": "openai/gpt-4",
  "proposed_preference": "anthropic/claude-3-5-sonnet",
  "rationale": "Better performance on coding tasks (recent data)"
}
```

---

## API Reference

### List Proposals

```bash
GET /v1/cognitive/proposals?status=pending&limit=10
```

**Query Parameters:**
- `status`: `pending`, `approved`, `rejected`, `applied`
- `tenant_id`: Filter by tenant (multi-tenant mode)
- `limit`: Results per page (default: 50)

**Response:**
```json
{
  "proposals": [...],
  "total": 3,
  "page": 1
}
```

### Get Proposal Details

```bash
GET /v1/cognitive/proposals/prop_abc123
```

Returns full recommendation with:
- Human-readable rationale
- Supporting evidence and metrics
- Projected impact
- Risk assessment
- Alternative options considered

### Approve Proposal

```bash
POST /v1/cognitive/proposals/prop_abc123/approve
{
  "approved_by": "admin@example.com",
  "notes": "Approved after review"
}
```

### Reject Proposal

```bash
POST /v1/cognitive/proposals/prop_abc123/reject
{
  "rejected_by": "admin@example.com",
  "reason": "Waiting for longer observation period"
}
```

### Apply Approved Proposal

```bash
POST /v1/cognitive/proposals/prop_abc123/apply
```

Executes the changes in production.

---

## Best Practices

### Daily Review

1. **Check pending proposals** each morning
2. **Prioritize high-confidence** (>0.90) recommendations
3. **Review risk scores** - extra scrutiny for medium/high risk
4. **Test in staging** before production (if self-hosted)

### Gradual Rollout

For critical changes:
1. Apply to 10% of traffic
2. Monitor for 24 hours
3. Expand to 50%
4. Monitor for 48 hours
5. Apply to 100%

### Monitoring

Track proposal accuracy:
- Compare projected vs actual impact
- Monitor error rates after applying
- Review cost savings achieved
- Adjust confidence thresholds based on results

---

## Safety Guarantees

**Default Human Approval**: Proposals require explicit approval unless auto-apply is enabled

**Confidence & Risk Scoring**: Every proposal quantifies certainty and potential downside

**Auto-Rollback Protection**: Auto-applied changes revert automatically if performance degrades

**Monitoring Window**: 1-hour observation period before changes become permanent

**Audit Trail**: Complete history of all proposals, approvals, and rollbacks

**Easy Manual Rollback**: Previous configurations saved and restorable anytime

---

## Configuration

Enable Cognitive Advisor in your dashboard:

```
Settings → Features → Cognitive Advisor → Enable
```

**Options:**
- Analysis Interval: 15-60 minutes (default: 15)
- Minimum Confidence: 0.5-0.95 (default: 0.75)
- Auto-Notify: Email when proposals are ready

### Auto-Apply Configuration (Scale Tier)

Enable automatic execution with rollback protection:

```bash
PUT /v1/cognitive/config
{
  "auto_apply_enabled": true,
  "auto_apply_threshold": 0.90,
  "max_risk_score": 0.30,
  "rollback_window_hours": 1,
  "latency_degradation_threshold": 0.10,
  "error_rate_degradation_threshold": 0.05,
  "cost_degradation_threshold": 0.10
}
```

**Auto-Apply Settings:**

| Setting | Default | Description |
|---------|---------|-------------|
| `auto_apply_enabled` | `false` | Enable automatic proposal execution |
| `auto_apply_threshold` | `0.90` | Minimum confidence for auto-apply |
| `max_risk_score` | `0.30` | Maximum risk score for auto-apply |
| `rollback_window_hours` | `1` | Monitoring window before changes are permanent |
| `latency_degradation_threshold` | `0.10` | Rollback if p95 latency increases >10% |
| `error_rate_degradation_threshold` | `0.05` | Rollback if error rate increases >5% |
| `cost_degradation_threshold` | `0.10` | Rollback if cost increases >10% |

### Automatic Rollback

When auto-apply is enabled, the system:

1. **Records Baseline**: Captures current p95 latency, error rate, and cost
2. **Applies Changes**: Executes the proposal atomically
3. **Monitors Performance**: Compares live metrics against baseline
4. **Auto-Rollback**: Reverts if any metric degrades beyond threshold
5. **Logs Outcome**: Records success/failure in audit log

```json
// Example rollback event
{
  "event": "auto_rollback_triggered",
  "proposal_id": "prop_abc123",
  "reason": "p95_latency_degradation",
  "baseline_p95_ms": 234,
  "observed_p95_ms": 312,
  "degradation_pct": 33.3,
  "rolled_back_at": "2026-01-26T13:15:00Z"
}
```

---

## Pricing

- **Developer Tier**: Not available
- **Growth Tier**: Up to 10 proposals/month
- **Scale Tier**: Unlimited proposals

[View Pricing →](/docs/pricing-tiers)

---

## FAQ

<details>
<summary><strong>Does this make automatic changes?</strong></summary>

**Default: No.** All recommendations require explicit human approval.

**Opt-in: Yes.** If you enable auto-apply (Scale tier), high-confidence/low-risk proposals execute automatically with rollback protection.

</details>

<details>
<summary><strong>What happens if auto-apply causes problems?</strong></summary>

Automatic rollback kicks in. The system monitors metrics for 1 hour after applying changes. If p95 latency, error rate, or cost degrades beyond your configured thresholds (default 10%, 5%, 10%), changes revert automatically. You're notified of the rollback via your configured notification channels.

</details>

<details>
<summary><strong>Can I mix manual and auto-apply?</strong></summary>

Yes. Auto-apply only triggers for proposals that meet BOTH your confidence threshold AND risk threshold. Lower-confidence or higher-risk proposals still require manual approval.

</details>

<details>
<summary><strong>How often does analysis run?</strong></summary>

Default: every 15 minutes. Configurable from 15-60 minutes.

</details>

<details>
<summary><strong>What if I reject all proposals?</strong></summary>

The system continues analyzing and learning. Rejections help improve future recommendations.

</details>

<details>
<summary><strong>Can I customize the scoring logic?</strong></summary>

Not directly, but confidence thresholds and risk gates are configurable. Contact support for custom scoring.

</details>

<details>
<summary><strong>What happens if an approved change causes issues?</strong></summary>

Use the one-click rollback feature to restore previous configuration. All changes are versioned.

</details>

---

## Related Features

- [Thompson Sampling](/docs/routing-policies) - Real-time intelligent routing
- [Council Mode](/docs/core-features/council-mode) - Multi-provider consensus
- [Observability](/docs/observability) - Performance monitoring

---

## Get Started

1. [Sign up for Growth or Scale tier](https://app.igrisinertial.com/signup)
2. Enable Cognitive Advisor in settings
3. Wait 1 hour for initial analysis
4. Review your first recommendations

**Questions?** Email support@igrisinertial.com
