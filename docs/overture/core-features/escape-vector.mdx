# EscapeVector Mode

**Your AI never goes down. Ever.**

When the control plane fails, Igris Overture automatically switches to intelligent local routing. No round-robin fallback. No degraded performance. The same Thompson Sampling algorithm keeps running offline.

---

## Quick Example

```python
from openai import OpenAI

client = OpenAI(
    base_url="https://api.igrisinertial.com/v1",
    api_key="your-key"
)

# Control plane goes down â†’ EscapeVector activates automatically
response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello"}]
)

# Still get intelligent routing, not random selection
print(response.metadata)
# {
#   "mode": "escapevector",
#   "provider": "anthropic",  # Best provider chosen via Thompson Sampling
#   "fallback_reason": "control_plane_timeout"
# }
```

---

## What You Get

### Zero-Downtime Failover

When the control plane becomes unavailable:

**Automatic Switch**: Detects failures in `<500ms`

**Thompson Sampling Continues**: Same intelligent routing algorithm

**Circuit Breakers**: Per-provider health tracking

**72-Hour Cache**: Works offline for up to 3 days

**Auto-Recovery**: Seamlessly returns to normal when control plane returns

### Why This Matters

**Other solutions** fall back to round-robin or static routing during outages, causing:
- Random provider selection
- Higher costs (no optimization)
- More errors (unhealthy providers still used)

**EscapeVector** maintains full intelligence:
- Same Thompson Sampling algorithm
- Cost-aware routing
- Circuit breakers active
- Quality preserved

---

## How It Works

<details>
<summary><strong>1. Continuous Health Monitoring</strong></summary>

The SDK monitors control plane health:
- Latency on every request
- Timeout detection (>500ms)
- Connection failures

After **3 consecutive failures**, EscapeVector activates.

</details>

<details>
<summary><strong>2. Local Thompson Sampling</strong></summary>

The SDK has a full Thompson Sampling implementation built-in:

- **Bayesian Optimization**: Maintains success/failure statistics per provider
- **Exploration/Exploitation**: Balances trying new providers vs using best ones
- **Circuit Breakers**: Automatically removes unhealthy providers
- **Cost Awareness**: Factors in provider pricing

This is the **exact same algorithm** that runs in the control plane.

</details>

<details>
<summary><strong>3. Encrypted State Cache (72 Hours)</strong></summary>

Provider statistics are cached locally:

- **Secure Storage**: Encrypted with AES-256
- **Tamper Protection**: HMAC signatures prevent manipulation
- **Auto-Refresh**: Updates on every successful request
- **72-Hour TTL**: Works offline for up to 3 days

When the cache expires, falls back to Gold Code Override.

</details>

<details>
<summary><strong>4. Gold Code Override</strong></summary>

For permanently offline environments (air-gapped, on-prem):

```bash
# Bypass control plane forever
export BYOK_BYPASS_CONTROL_PLANE=true
```

The SDK operates completely independently with configurable fallback strategy.

</details>

---

## Activation Triggers

EscapeVector activates when:

1. **Control Plane Timeout**: >500ms latency on 3 consecutive requests
2. **Connection Failure**: Network errors or DNS failures
3. **Gold Code Override**: `BYOK_BYPASS_CONTROL_PLANE=true` environment variable
4. **Manual Override**: Force EscapeVector mode via API

---

## Performance

### Tested at Scale

| Metric | Result |
|--------|--------|
| **Success Rate** | 94.2% (10k requests during outage) |
| **Latency Overhead** | `<10ms` P99 |
| **Offline Duration** | Up to 72 hours |
| **Recovery Time** | `<1 second` when control plane returns |

### Real-World Example

During a 2-hour control plane outage:
- **0 downtime** for customers
- **94% success rate** maintained
- **Cost optimization** continued working
- **Circuit breakers** prevented using failed providers

---

## Configuration

### Default Behavior (Automatic)

EscapeVector is enabled by default. No configuration needed.

```python
# Works automatically
client = OpenAI(
    base_url="https://api.igrisinertial.com/v1",
    api_key="your-key"
)
```

### Gold Code Override (Permanent Offline)

For air-gapped deployments:

```bash
export BYOK_BYPASS_CONTROL_PLANE=true
export IGRIS_CACHE_DIR="/custom/path"
```

```python
# Client never contacts control plane
client = OpenAI(base_url="...", api_key="...")
response = client.chat.completions.create(...)
```

### Custom Cache Location

```bash
export IGRIS_CACHE_DIR="/var/cache/igris"
```

---

## Security

### Encrypted State Storage

- **Algorithm**: AES-256-GCM
- **Integrity**: HMAC signatures
- **Tamper Detection**: Clock rollback prevention

### No Sensitive Data

The cache only stores:
- Provider performance statistics (success/failure counts)
- Latency percentiles
- Cost efficiency scores

**Never stored:**
- API keys
- Request/response data
- User information

---

## FAQ

<details>
<summary><strong>How long can I stay offline?</strong></summary>

Up to 72 hours with cached state. After that, falls back to Gold Code Override strategy.

</details>

<details>
<summary><strong>Does quality degrade during outages?</strong></summary>

No. EscapeVector uses the same Thompson Sampling algorithm as normal operation. Quality is maintained.

</details>

<details>
<summary><strong>What happens when the control plane returns?</strong></summary>

Automatic seamless switch back to normal mode within `<1 second`. No manual intervention needed.

</details>

<details>
<summary><strong>Can I force EscapeVector mode?</strong></summary>

Yes. Set `BYOK_BYPASS_CONTROL_PLANE=true` to permanently run in EscapeVector mode (air-gapped deployments).

</details>

<details>
<summary><strong>Is there additional latency?</strong></summary>

Minimal. P99 latency overhead is `<10ms` for local Thompson Sampling computation.

</details>

---

## Monitoring

### Metadata in Responses

Every request includes mode information:

```json
{
  "metadata": {
    "mode": "escapevector",
    "fallback_reason": "control_plane_timeout",
    "provider": "anthropic",
    "cache_age_hours": 2.5,
    "thompson_score": 0.87
  }
}
```

### Dashboard Alerts

Get notified when EscapeVector activates:

- **Email**: Immediate notification
- **Webhook**: POST to your endpoint
- **Dashboard**: Visual indicator

---

## Pricing

EscapeVector is included in all tiers:

- **Developer**: Included
- **Growth**: Included
- **Scale**: Included

No additional cost for failover capability.

---

## Related Features

- [Thompson Sampling](/docs/routing-policies) - Intelligent routing algorithm
- [Circuit Breakers](/docs/core-features/hotfix-blob) - Health tracking
- [Observability](/docs/observability) - Monitoring and metrics

---

## Get Started

EscapeVector is enabled by default. Just start using Igris Overture:

```python
from openai import OpenAI

client = OpenAI(
    base_url="https://api.igrisinertial.com/v1",
    api_key="your-key"
)

# EscapeVector automatically protects you
response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello"}]
)
```

**Questions?** Email support@igrisinertial.com
