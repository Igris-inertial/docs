# Gold Code Override

## Overview

**Gold Code Override** is Igris Overture's permanent control plane bypass mode that enables fully autonomous operation in air-gapped, edge, or zero-trust environments. When enabled, the SDK operates entirely independently using locally cached Thompson Sampling parameters.

This feature is designed for:
- **Air-gapped deployments** where control plane access is impossible
- **Edge computing** scenarios with unreliable connectivity
- **Zero-trust architectures** that prohibit external dependencies
- **Disaster recovery** scenarios requiring complete independence

## Key Features

### Permanent Bypass

- **Environment Variable Control**: Single flag to disable all control plane communication
- **No Network Dependency**: Operates entirely on local state
- **Configurable Strategy**: Choose between Thompson Sampling or round-robin fallback
- **Production Ready**: Full feature parity with cloud-connected mode

### Local Intelligence

- **Thompson Sampling Preservation**: Maintains Bayesian optimization locally
- **State Persistence**: Encrypted cache survives process restarts
- **Adaptive Learning**: Continues learning from request outcomes
- **Performance Tracking**: Full metrics and observability without cloud

### Zero Configuration

- **Default Providers**: Ships with sensible defaults (OpenAI, Anthropic, etc.)
- **Automatic Initialization**: Bootstraps with α=1, β=1 for each provider
- **Gradual Learning**: Quickly adapts to actual performance patterns
- **No Manual Setup**: Works out-of-the-box

## Usage

### Enabling Gold Code Override

```bash
# Permanently bypass control plane
export BYOK_BYPASS_CONTROL_PLANE=true

# Optional: Custom cache directory
export IGRIS_CACHE_DIR="/custom/path"

# Optional: Choose fallback strategy (thompson | round-robin)
export IGRIS_FALLBACK_STRATEGY="thompson"
```

### SDK Integration

```go
import "github.com/igris-inertial/igris-overture/internal/sdk/go/igris"

// Client automatically detects Gold Code Override
client := igris.NewClient(&igris.Config{
    APIKey: "your-api-key", // Used for encryption key derivation only
})

// All inference requests use local Thompson Sampling
response, err := client.Infer(ctx, &igris.InferRequest{
    Model: "gpt-4",
    Messages: []igris.Message{
        {Role: "user", Content: "Hello from edge deployment!"},
    },
})
```

### Python SDK

```python
import os
os.environ['BYOK_BYPASS_CONTROL_PLANE'] = 'true'

from igris import IgrisClient

# Client operates entirely offline
client = IgrisClient(api_key="your-api-key")

response = client.infer(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)
```

### JavaScript SDK

```javascript
// Set environment variable before importing
process.env.BYOK_BYPASS_CONTROL_PLANE = 'true';

import { IgrisClient } from '@igris/sdk';

const client = new IgrisClient({
  apiKey: 'your-api-key'
});

const response = await client.infer({
  model: 'gpt-4',
  messages: [{ role: 'user', content: 'Hello!' }]
});
```

## Architecture

### Gold Code Flow

```
┌─────────────────────────────────────────┐
│         Application Code                │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│         Igris SDK Client               │
│                                         │
│  ┌──────────────────────────────────┐  │
│  │  Gold Code Detector              │  │
│  │  • Checks BYOK_BYPASS flag       │  │
│  │  • Skips control plane           │  │
│  └──────────────────────────────────┘  │
│              │                          │
│              ▼                          │
│  ┌──────────────────────────────────┐  │
│  │  Local Thompson Router           │  │
│  │  • Beta(α,β) sampling            │  │
│  │  • Composite rewards             │  │
│  │  • Circuit breakers              │  │
│  └──────────────────────────────────┘  │
│              │                          │
│              ▼                          │
│  ┌──────────────────────────────────┐  │
│  │  Encrypted Cache                 │  │
│  │  • Persists α/β parameters       │  │
│  │  • Survives restarts             │  │
│  └──────────────────────────────────┘  │
│              │                          │
│              ▼                          │
│  ┌──────────────────────────────────┐  │
│  │  Provider Selection              │  │
│  │  • Direct API calls              │  │
│  │  • No intermediary               │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

## Default Configuration

### Built-in Providers

Gold Code Override ships with default configurations for popular providers:

```go
var DefaultProviders = []Provider{
    {
        ID:       "openai",
        Name:     "OpenAI GPT-4",
        Endpoint: "https://api.openai.com/v1/chat/completions",
        Alpha:    1.0,
        Beta:     1.0,
    },
    {
        ID:       "anthropic",
        Name:     "Anthropic Claude",
        Endpoint: "https://api.anthropic.com/v1/messages",
        Alpha:    1.0,
        Beta:     1.0,
    },
    // Additional providers...
}
```

### Fallback Strategies

**Thompson Sampling (Recommended)**
- Maintains Bayesian optimization
- Adapts to provider performance
- Continues exploration/exploitation
- Default strategy

**Round-Robin**
- Simple rotation through providers
- Predictable distribution
- Useful for load balancing
- Set via `IGRIS_FALLBACK_STRATEGY=round-robin`

## Use Cases

### Air-Gapped Enterprise Deployment

```bash
# Deploy in restricted environment
export BYOK_BYPASS_CONTROL_PLANE=true
export IGRIS_CACHE_DIR="/secure/storage/igris"

# Configure provider API keys
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."

# Run application
./my-app
```

### Edge Computing

```dockerfile
# Dockerfile for edge deployment
FROM alpine:latest

ENV BYOK_BYPASS_CONTROL_PLANE=true
ENV IGRIS_CACHE_DIR=/app/cache

COPY app /app/
COPY igris_cache /app/cache/

ENTRYPOINT ["/app/app"]
```

### Disaster Recovery

Gold Code Override automatically activates during extended outages:

1. Control plane becomes unavailable
2. EscapeVector Mode activates (first 72 hours)
3. After cache expiration, Gold Code Override ensures continued operation
4. System continues learning and adapting locally

## Performance

### Overhead Comparison

| Mode | Control Plane Latency | Total Overhead |
|------|----------------------|----------------|
| **Cloud Connected** | 5-15ms | 15-25ms |
| **Gold Code Override** | 0ms | 8-12ms |

Gold Code Override is actually **faster** than cloud-connected mode due to elimination of network round-trips.

### Learning Convergence

Starting from default parameters (α=1, β=1), the system typically converges to optimal provider selection within:

- **100 requests**: Basic preference established
- **500 requests**: Stable performance differentiation
- **1000 requests**: Near-optimal provider selection

## Security

### Encryption at Rest

- **Algorithm**: AES-256-GCM
- **Key Derivation**: SHA-256(API_KEY)
- **Integrity**: HMAC-SHA256 signature

### Tamper Detection

- File integrity verification on load
- Clock rollback detection
- Automatic re-initialization on tampering

### Secure Storage

```bash
# Default cache location with restricted permissions
~/.config/igris/bayesian_state.enc
# Permissions: 0600 (owner read/write only)
```

## Configuration Options

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `BYOK_BYPASS_CONTROL_PLANE` | `false` | Enable Gold Code Override |
| `IGRIS_CACHE_DIR` | `~/.config/igris` | Cache directory path |
| `IGRIS_FALLBACK_STRATEGY` | `thompson` | Fallback strategy (thompson\|round-robin) |
| `IGRIS_EXPLORATION_RATE` | `0.10` | Exploration rate (0.0-1.0) |
| `IGRIS_CACHE_TTL_HOURS` | `72` | Cache validity duration |

### Programmatic Configuration

```go
client := igris.NewClient(&igris.Config{
    GoldCodeOverride: true,
    FallbackStrategy: "thompson",
    ExplorationRate:  0.15,
    CacheDir:         "/custom/cache",
})
```

## Monitoring & Observability

### Local Metrics

Even in Gold Code Override mode, full observability is maintained:

```go
metrics := client.GetMetrics()

fmt.Printf("Total Requests: %d\n", metrics.TotalRequests)
fmt.Printf("Success Rate: %.2f%%\n", metrics.SuccessRate)
fmt.Printf("Avg Latency: %dms\n", metrics.AvgLatencyMs)
fmt.Printf("Provider Distribution: %+v\n", metrics.ProviderDistribution)
```

### Prometheus Integration

```go
// Expose metrics endpoint
http.Handle("/metrics", promhttp.Handler())
```

Metrics are available locally without requiring cloud connectivity.

## Limitations

### No Remote Sync

- Cannot receive policy updates from control plane
- Cannot contribute learning to global optimization
- Operates entirely on local state

### Initial Cold Start

- First requests use default parameters (α=1, β=1)
- Requires learning period to establish preferences
- Pre-warming cache recommended for production

### Manual Updates

- Provider list must be updated manually
- No automatic discovery of new providers
- Configuration changes require redeploy

## Best Practices

### Pre-Warm Cache

For production deployments, initialize cache with known-good parameters:

```bash
# Generate initial cache from successful deployment
igris-cli cache export --output bayesian_state.enc

# Deploy with pre-warmed cache
docker build --build-arg CACHE_FILE=bayesian_state.enc .
```

### Monitor Learning Progress

```go
state := client.GetBayesianState()
for _, provider := range state.Providers {
    fmt.Printf("%s: α=%.2f, β=%.2f, selections=%d\n",
        provider.ID, provider.Alpha, provider.Beta, provider.TotalSelections)
}
```

### Regular Backups

```bash
# Backup cache periodically
cp ~/.config/igris/bayesian_state.enc /backups/$(date +%Y%m%d).enc
```

## FAQ

### Does Gold Code Override disable all cloud features?

Yes, it operates entirely independently. No telemetry, updates, or control plane communication.

### Can I switch back to cloud-connected mode?

Yes, simply unset `BYOK_BYPASS_CONTROL_PLANE=false` and restart. The local cache will sync with the control plane.

### What happens if cache is corrupted?

System automatically falls back to default parameters and begins learning from scratch.

### Is there a performance penalty?

No, Gold Code Override is actually faster due to eliminated network latency.

### How do I update provider configurations?

Update environment variables for API keys or modify the provider list in code, then redeploy.

## Related Features

- [EscapeVector Mode](/docs/core-features/escape-vector) - Automatic failover with cache
- [Speculative Execution](/docs/core-features/speculative) - Parallel provider racing
- [Hotfix Blob](/docs/core-features/hotfix-blob) - Emergency configuration updates

## Support

For air-gapped deployment support:
- Email: enterprise@igris-overture.com
- Documentation: /docs/deployment/air-gapped
